#pragma once
#ifndef MY_FUNCTIONS_H
#define MY_FUNCTIONS_H
#endif  !MY_FUNCTIONS_H
#pragma once
#include <iostream>
#include <cmath>
#include <cstdlib>
#include <ctime>
#include <vector>
#include <math.h>
#include <string>
#include <math.h>
#include <vector>
#include <random>
#include <chrono>
#include <fstream>
#include <map>
//chrono
#include <chrono>
using namespace std;
const double deoxy_data[] = {
            97.58, 97.24668630103302, 100.024, 105.91194109690093, 119.18599999999998, 144.12166711756137, 171.316, 191.36605619773087, 213.689, 247.70199569605347, 272.27, 266.2579696259483, 223.01, 135.87018654825664, 51.604, 16.97691108451183, 9.882, 8.212346944672365, 8.899000000000001, 8.873007247453975, 8.634, 8.681609570603786, 9.119, 10.049335328923313, 11.365000000000002, 12.958378455856344, 14.672999999999998, 16.35239393593862, 18.105, 20.039257928511944, 22.129, 24.348058492989708, 26.427, 28.096391113549814, 29.245000000000005, 29.76159482571142, 29.669, 28.990039932181688, 27.538, 25.126165581198457, 21.955, 18.22496658062756, 14.467, 11.212034935036193, 8.525, 6.470823809155298, 4.979000000000001, 3.9790222100320287, 3.337, 2.919042930652537, 2.646, 2.4387202060527526, 2.2760000000000002, 2.1366358330309474, 2.015, 1.905464795761565, 1.803, 1.702575392399664, 1.601, 1.4950828498404518, 1.386, 1.2749275085576262, 1.167, 1.0673520988137917, 1.0000000000000002, 0.9889598985596247, 0.999, 0.9948885098284603, 0.987, 0.9857090424696132, 0.985, 0.9788572353538606, 0.97, 0.9611475454072232, 0.95, 0.9342574922028001, 0.92, 0.9133075013759765, 0.91, 0.9058974995413411, 0.901
};

const double oxy_data[] = {
    185.0, 192.57373720944835, 195.0, 192.2787883716549, 200.0, 233.75353256062215, 270.473, 287.09201626461225, 263.925, 181.28636985170434, 108.075, 113.18976462516179, 131.344, 97.25104239732498, 52.19100000000001, 37.443980990888335, 36.028999999999996, 30.965071657345057, 24.951, 20.68558906504135, 17.759000000000004, 15.761393952406863, 14.371999999999998, 13.27004722051748, 12.369000000000002, 11.582322724488264, 11.005000000000003, 10.732016432552953, 10.893, 11.617578680194026, 13.921, 18.8185114862829, 24.400999999999996, 28.759352402108576, 30.281000000000002, 27.353374101065647, 22.739, 19.200402991497548, 17.885, 19.940207949949095, 23.322, 25.986349308807895, 24.521, 15.513696197203544, 5.762, 2.0634735079708535, 1.475, 1.0534627549713358, 0.778, 0.6277499622011322, 0.53, 0.4120374718218712, 0.307, 0.24802520686764065, 0.21900000000000003, 0.2038112869722848, 0.19600000000000006, 0.18910707129865068, 0.18200000000000002, 0.17354628523581117, 0.16500000000000004, 0.1576152172864823, 0.152, 0.1487624110452951, 0.148, 0.14981031644174703, 0.15200000000000002, 0.1523756903042227, 0.152, 0.15193554173291662, 0.15200000000000002, 0.15201105929827746, 0.152, 0.15199810247741857, 0.152, 0.15200032583721096, 0.15200000000000002, 0.1519999424993157, 0.15200000000000002, 0.15200001916689476, 0.152

};
const double wavelengths[] = {
    380, 385, 390, 395, 400, 405, 410, 415, 420, 425, 430, 435, 440, 445, 450, 455, 460, 465, 470, 475, 480, 485, 490, 495, 500, 505, 510, 515, 520, 525, 530, 535, 540, 545, 550, 555, 560, 565, 570, 575, 580, 585, 590, 595, 600, 605, 610, 615, 620, 625, 630, 635, 640, 645, 650, 655, 660, 665, 670, 675, 680, 685, 690, 695, 700, 705, 710, 715, 720, 725, 730, 735, 740, 745, 750, 755, 760, 765, 770, 775, 780 };
const int numCoefficients = sizeof(wavelengths);
const vector<std::pair<double, double>> deoxy_hb_3 = {
        {380, 97.58},
        {390, 100.024},
        {400, 119.186},
        {410, 171.316},
        {420, 213.689},
        {430, 272.27},
        {440, 223.01},
        {450, 51.604},
        {460, 9.882},
        {470, 8.899},
        {480, 8.634},
        {490, 9.119},
        {500, 11.365},
        {510, 14.673},
        {520, 18.105},
        {530, 22.129},
        {540, 26.427},
        {550, 29.245},
        {560, 29.669},
        {570, 27.538},
        {580, 21.955},
        {590, 14.467},
        {600, 8.525},
        {610, 4.979},
        {620, 3.337},
        {630, 2.646},
        {640, 2.276},
        {650, 2.015},
        {660, 1.803},
        {670, 1.601},
        {680, 1.386},
        {690, 1.167},
        {700, 1.0},
        {710, 0.999},
        {720, 0.987},
        {730, 0.985},
        {740, 0.97},
        {750, 0.95},
        {760, 0.92},
        {770, 0.91},
        {780, 0.901}
};

const vector<std::pair<double, double>> oxy_hb_3 = {
    {380, 185},
    {390, 195},
    {400, 200},
    {410, 270.473},
    {420, 263.925},
    {430, 108.075},
    {440, 131.344},
    {450, 52.191},
    {460, 36.029},
    {470, 24.951},
    {480, 17.759},
    {490, 14.372},
    {500, 12.369},
    {510, 11.005},
    {520, 10.893},
    {530, 13.921},
    {540, 24.401},
    {550, 30.281},
    {560, 22.739},
    {570, 17.885},
    {580, 23.322},
    {590, 24.521},
    {600, 5.762},
    {610, 1.475},
    {620, 0.778},
    {630, 0.53},
    {640, 0.307},
    {650, 0.219},
    {660, 0.196},
    {670, 0.182},
    {680, 0.165},
    {690, 0.152},
    {700, 0.148},
    {710, 0.152},
    {720, 0.152},
    {730, 0.152},
    {740, 0.152},
    {750, 0.152},
    {760, 0.152},
    {770, 0.152},
    {780, 0.152}
};
double getDeoxyHbValue(int wavelength);
double getOxyHbValue(int wavelength);
double RFresnel(double, double, double);

double xFit_1931(double wave);
double yFit_1931(double wave);
double zFit_1931(double wave);
double gamma_correction(double C);

std::vector<double> XYZ_to_sRGB(std::vector<double> xyz, int step_size);
std::vector<double> Get_RGB(std::vector<double> wavelengths, std::vector<double> reflectances, int step_size);

void write_csv(const std::string filename, const std::vector<std::vector<double>>& data);
void WriteRowToCSV(std::ofstream& file, const std::vector<double>& row);
void WriteHeaderToCSV(std::ofstream& file);
std::pair<double, double> calculate_absorption_coefficient(double wavelength);